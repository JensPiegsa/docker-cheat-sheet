<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>Docker Cheat Sheet by JensPiegsa</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">Docker Cheat Sheet</h1>
      <h2 class="project-tagline">Find, Copy and Paste, Anywhere.</h2>
      <a href="https://github.com/JensPiegsa/docker-cheat-sheet" class="btn">View on GitHub</a>
      <a href="https://github.com/JensPiegsa/docker-cheat-sheet/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/JensPiegsa/docker-cheat-sheet/tarball/master" class="btn">Download .tar.gz</a>
    </section>

    <section class="main-content">
      <p><a href="https://www.paypal.com/cgi-bin/webscr?cmd=_s-xclick&amp;hosted_button_id=WZJTZ3V8KKARC"><img src="https://img.shields.io/badge/Donate-PayPal-blue.svg" alt="Donate"></a> <a href="https://github.com/JensPiegsa/docker-cheat-sheet/edit/master/README.md#fork-destination-box"><img src="https://img.shields.io/github/forks/badges/shields.svg?style=flat&amp;label=Fork%20on%20GitHub&amp;color=blue" alt="Fork on GitHub"></a></p>

<h1>
<a id="content" class="anchor" href="#content" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Content</h1>

<ul>
<li><a href="#1-terminology">1. Terminology</a></li>
<li>
<a href="#2-how-tos">2. How-tos</a>

<ul>
<li>
<a href="#21-docker-engine">2.1. Docker Engine</a>

<ul>
<li><a href="#211-building-images">2.1.1. Building Images</a></li>
<li><a href="#212-running-containers">2.1.2. Running Containers</a></li>
<li><a href="#213-using-volumes">2.1.3. Using Volumes</a></li>
</ul>
</li>
<li><a href="#22-docker-machine">2.2. Docker Machine</a></li>
<li><a href="#23-dockerfile">2.3. Dockerfile</a></li>
</ul>
</li>
<li><a href="#3-best-practices">3. Best Practices</a></li>
<li><a href="#4-additional-material">4. Additional Material</a></li>
</ul>

<h1>
<a id="1-terminology" class="anchor" href="#1-terminology" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>1. Terminology</h1>

<ul>
<li><strong>Image</strong></li>
<li><strong>Container</strong></li>
<li><strong>Volume</strong></li>
<li><strong>Network</strong></li>
<li><strong>Service</strong></li>
</ul>

<h1>
<a id="2-how-tos" class="anchor" href="#2-how-tos" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>2. How-tos</h1>

<h2>
<a id="21-docker-engine" class="anchor" href="#21-docker-engine" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>2.1. Docker Engine</h2>

<h3>
<a id="211-building-images" class="anchor" href="#211-building-images" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>2.1.1. Building Images</h3>

<h4>
<a id="debug-image-build" class="anchor" href="#debug-image-build" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Debug image build</h4>

<ul>
<li>
<code>docker build</code> shows the IDs of all temporary containers and intermediate images</li>
<li>use <code>docker run -it IMAGE_ID</code> with the ID of the image resulting from the last successful build step and try the next command manually</li>
</ul>

<h3>
<a id="212-running-containers" class="anchor" href="#212-running-containers" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>2.1.2. Running Containers</h3>

<h4>
<a id="start-container-and-run-command-inside" class="anchor" href="#start-container-and-run-command-inside" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Start container and run command inside</h4>

<pre><code>docker run -it ubuntu:14.04 /bin/bash
</code></pre>

<h4>
<a id="start-a-shell-in-a-running-container" class="anchor" href="#start-a-shell-in-a-running-container" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Start a shell in a running container</h4>

<pre><code>docker exec -it CONTAINER /bin/bash
</code></pre>

<h4>
<a id="stop-all-running-containers" class="anchor" href="#stop-all-running-containers" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Stop all running containers</h4>

<pre><code>docker stop $(docker ps -q)
</code></pre>

<h4>
<a id="remove-all-stopped-containers-except-those-suffixed--data" class="anchor" href="#remove-all-stopped-containers-except-those-suffixed--data" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Remove all stopped containers, except those suffixed '-data':</h4>

<pre><code>docker ps -a -f status=exited | grep -v '\-data *$'| awk '{if(NR&gt;1) print $1}' | xargs -r docker rm
</code></pre>

<h4>
<a id="remove-all-stopped-containers-warning-removes-data-only-containers-too" class="anchor" href="#remove-all-stopped-containers-warning-removes-data-only-containers-too" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Remove all stopped containers (warning: removes data-only containers too)</h4>

<pre><code>docker rm $(docker ps -qa -f status=exited)
</code></pre>

<ul>
<li><em>note: the filter flag <code>-f status=exited</code> may be omitted here since running containers can not be removed</em></li>
</ul>

<h4>
<a id="remove-all-unused-images" class="anchor" href="#remove-all-unused-images" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Remove all unused images</h4>

<pre><code>docker rmi $(docker images -qa -f dangling=true)
</code></pre>

<h4>
<a id="show-image-history-of-container" class="anchor" href="#show-image-history-of-container" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Show image history of container</h4>

<pre><code>docker history --no-trunc=true $(docker inspect -f '{{.Image}}' CONTAINER)
</code></pre>

<h4>
<a id="show-file-system-changes-compared-to-the-original-image" class="anchor" href="#show-file-system-changes-compared-to-the-original-image" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Show file system changes compared to the original image</h4>

<pre><code>docker diff CONTAINER
</code></pre>

<h4>
<a id="backup-volume" class="anchor" href="#backup-volume" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Backup volume</h4>

<div class="highlight highlight-source-shell"><pre>docker run -rm --volumes-from SOURCE_CONTAINER -v <span class="pl-s"><span class="pl-pds">$(</span><span class="pl-c1">pwd</span><span class="pl-pds">)</span></span>:/backup busybox \
 tar cvf /backup/backup.tar /data</pre></div>

<h4>
<a id="restore-volume" class="anchor" href="#restore-volume" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Restore volume</h4>

<pre><code>docker run -rm --volumes-from TARGET_CONTAINER -v $(pwd):/backup busybox tar xvf /backup/backup.tar
</code></pre>

<h4>
<a id="show-volumes" class="anchor" href="#show-volumes" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Show volumes</h4>

<pre><code>docker inspect -f '{{range $v, $h := .Config.Volumes}}{{$v}}{{end}}' CONTAINER
</code></pre>

<h4>
<a id="start-all-paused--stopped-containers" class="anchor" href="#start-all-paused--stopped-containers" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Start all paused / stopped containers</h4>

<ul>
<li>makes no sense together with container dependencies</li>
</ul>

<h4>
<a id="remove-all-containers-and-images" class="anchor" href="#remove-all-containers-and-images" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Remove all containers and images</h4>

<pre><code>docker stop $(docker ps -q) &amp;&amp; docker rm $(docker ps -qa) &amp;&amp; docker rmi $(docker images -qa)
</code></pre>

<h4>
<a id="edit-and-update-a-file-in-a-container" class="anchor" href="#edit-and-update-a-file-in-a-container" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Edit and update a file in a container</h4>

<div class="highlight highlight-source-shell"><pre>docker cp CONTAINER:FILE /tmp/ <span class="pl-k">&amp;&amp;</span> docker run --name=nano -it --rm -v /tmp:/tmp \
 piegsaj/nano nano /tmp/FILE <span class="pl-k">;</span> \
cat /tmp/FILE <span class="pl-k">|</span> docker <span class="pl-c1">exec</span> -i CONTAINER sh -c <span class="pl-s"><span class="pl-pds">'</span>cat &gt; FILE<span class="pl-pds">'</span></span> <span class="pl-k">;</span> \
rm /tmp/FILE</pre></div>

<h4>
<a id="deploy-war-file-to-apache-tomcat-server-instantly" class="anchor" href="#deploy-war-file-to-apache-tomcat-server-instantly" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Deploy war file to Apache Tomcat server instantly</h4>

<div class="highlight highlight-source-shell"><pre>docker run -i -t -p 80:8080 -e WAR_URL=“<span class="pl-k">&lt;</span>http://web-actions.googlecode.com/files/helloworld.war<span class="pl-k">&gt;</span>” \
 bbytes/tomcat7</pre></div>

<h4>
<a id="dump-a-postgres-database-into-your-current-directory-on-the-host" class="anchor" href="#dump-a-postgres-database-into-your-current-directory-on-the-host" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Dump a Postgres database into your current directory on the host</h4>

<div class="highlight highlight-source-shell"><pre><span class="pl-c1">echo</span> <span class="pl-s"><span class="pl-pds">"</span>postgres_password<span class="pl-pds">"</span></span> <span class="pl-k">|</span> sudo docker run -i --rm --link db:db -v <span class="pl-smi">$PWD</span>:/tmp postgres:8 sh -c <span class="pl-s"><span class="pl-pds">'</span> \</span>
<span class="pl-s"> pg_dump -h ocdb -p $OCDB_PORT_5432_TCP_PORT -U postgres -F tar -v openclinica \</span>
<span class="pl-s"> &gt; /tmp/ocdb_pg_dump_$(date +%Y-%m-%d_%H-%M-%S).tar<span class="pl-pds">'</span></span></pre></div>

<h4>
<a id="backup-data-folder" class="anchor" href="#backup-data-folder" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Backup data folder</h4>

<pre><code>docker run --rm --volumes-from oc-data -v $PWD:/tmp piegsaj/openclinica \
 tar cvf /tmp/oc_data_backup_$(date +%Y-%m-%d_%H-%M-%S).tar /tomcat/openclinica.data
</code></pre>

<h4>
<a id="restore-volume-from-data-only-container" class="anchor" href="#restore-volume-from-data-only-container" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Restore volume from data-only container</h4>

<pre><code>docker run --rm --volumes-from oc-data2 -v $pwd:/tmp piegsaj/openclinica \
 tar xvf /tmp/oc_data_backup_*.tar
</code></pre>

<h4>
<a id="copy-content-of-existing-named-volume-to-a-new-named-volume" class="anchor" href="#copy-content-of-existing-named-volume-to-a-new-named-volume" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Copy content of existing named volume to a new named volume</h4>

<pre><code>docker volume create --name vol_b
docker run --rm -v vol_a:/source/folder -v vol_b:/target/folder -it \
 rawmind/alpine-base:0.3.4 cp -r /source/folder /target
</code></pre>

<h4>
<a id="get-the-ip-address-of-a-container" class="anchor" href="#get-the-ip-address-of-a-container" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Get the IP address of a container</h4>

<pre><code>docker inspect container_id | grep IPAddress | cut -d '"' -f 4
</code></pre>

<h2>
<a id="213-using-volumes" class="anchor" href="#213-using-volumes" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>2.1.3. Using Volumes</h2>

<h4>
<a id="declare-a-volume-via-dockerfile" class="anchor" href="#declare-a-volume-via-dockerfile" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Declare a volume via Dockerfile</h4>

<pre><code>RUN mkdir /data &amp;&amp; echo "some content" &gt; /data/file &amp;&amp; chown -R daemon:daemon /data
VOLUME /data
</code></pre>

<ul>
<li><em>note: after the <code>VOLUME</code> directive, its content can not be changed within the Dockerfile</em></li>
</ul>

<h4>
<a id="create-a-volume-at-runtime" class="anchor" href="#create-a-volume-at-runtime" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Create a volume at runtime</h4>

<pre><code>docker run -it -v /data debian /bin/bash
</code></pre>

<h4>
<a id="create-a-volume-at-runtime-bound-to-a-host-directory" class="anchor" href="#create-a-volume-at-runtime-bound-to-a-host-directory" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Create a volume at runtime bound to a host directory</h4>

<pre><code>docker run --rm -v /tmp:/data debian ls -RAlph /data
</code></pre>

<h4>
<a id="create-a-named-volume-and-use-it" class="anchor" href="#create-a-named-volume-and-use-it" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Create a named volume and use it</h4>

<pre><code>docker volume create --name=test
docker run --rm -it -v test:/data alpine sh -c 'echo "Hello named volumes" &gt; /data/hello.txt'
docker run --rm -it -v test:/data alpine sh -c 'cat /data/hello.txt'
</code></pre>

<h4>
<a id="copy-a-file-from-host-to-named-volume" class="anchor" href="#copy-a-file-from-host-to-named-volume" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Copy a file from host to named volume</h4>

<pre><code>echo "debug=true" &gt; test.cnf &amp;&amp; \
docker volume create --name=conf &amp;&amp; \
docker run --rm -it -v $(pwd):/src -v conf:/dest alpine cp /src/test.cnf /dest/ &amp;&amp; \
rm -f test.cnf &amp;&amp; \
docker run --rm -it -v conf:/data alpine cat /data/test.cnf
</code></pre>

<h4>
<a id="list-the-content-of-a-volume" class="anchor" href="#list-the-content-of-a-volume" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>List the content of a volume</h4>

<pre><code>docker run --rm -v data:/data alpine ls -RAlph /data
</code></pre>

<h2>
<a id="22-docker-machine" class="anchor" href="#22-docker-machine" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>2.2. Docker Machine</h2>

<h3>
<a id="on-a-local-vm" class="anchor" href="#on-a-local-vm" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>On a local VM</h3>

<h4>
<a id="get-the-ip-address-of-the-virtual-machine-for-access-from-host" class="anchor" href="#get-the-ip-address-of-the-virtual-machine-for-access-from-host" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Get the IP address of the virtual machine for access from host</h4>

<pre><code>docker-machine ip default
</code></pre>

<h4>
<a id="add-persistent-environment-variable-to-boot2docker" class="anchor" href="#add-persistent-environment-variable-to-boot2docker" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Add persistent environment variable to boot2docker</h4>

<pre><code>sudo echo 'echo '\''export ENVTEST="Hello Env!"'\'' &gt; /etc/profile.d/custom.sh' | \
sudo tee -a /var/lib/boot2docker/profile &gt; /dev/null
</code></pre>

<p>and restart with <code>docker-machine restart default</code></p>

<h4>
<a id="install-additional-linux-packages-in-boot2docker" class="anchor" href="#install-additional-linux-packages-in-boot2docker" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Install additional linux packages in boot2docker</h4>

<ul>
<li>create the file <code>/var/lib/boot2docker/bootsync.sh</code> with a content like:</li>
</ul>

<pre><code>#!/bin/sh
sudo /bin/su - docker -c 'tce-load -wi nano'
</code></pre>

<h4>
<a id="recreate-any-folders-and-files-on-boot2docker-startup" class="anchor" href="#recreate-any-folders-and-files-on-boot2docker-startup" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Recreate any folders and files on boot2docker startup</h4>

<ul>
<li>store folders / files in <code>/var/lib/boot2docker/restore-on-boot</code> and</li>
<li>create the file <code>/var/lib/boot2docker/bootsync.sh</code> with a content like:</li>
</ul>

<pre><code>#!/bin/sh
sudo mkdir -p /var/lib/boot2docker/restore-on-boot &amp;&amp;
sudo rsync -a /var/lib/boot2docker/restore-on-boot/ /
</code></pre>

<h2>
<a id="23-dockerfile" class="anchor" href="#23-dockerfile" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>2.3. Dockerfile</h2>

<h4>
<a id="add-a-periodic-health-check" class="anchor" href="#add-a-periodic-health-check" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Add a periodic health check</h4>

<pre><code>HEALTHCHECK --interval=1m --timeout=3s --retries=5 \
 CMD curl -f &lt;http://localhost/&gt; || exit 1
</code></pre>

<ul>
<li>see also: <a href="https://docs.docker.com/engine/reference/builder/#/healthcheck">HEALTHCHECK</a>
</li>
</ul>

<h1>
<a id="3-best-practices" class="anchor" href="#3-best-practices" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>3. Best Practices</h1>

<h2>
<a id="docker-engine" class="anchor" href="#docker-engine" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Docker Engine</h2>

<ul>
<li>
<code>docker exec</code> is your friend in development, but should be avoided in a production setup</li>
</ul>

<h2>
<a id="volumes" class="anchor" href="#volumes" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Volumes</h2>

<ul>
<li>use <em>named volumes</em> to simplify maintenance by separating persistent data from the container and communicating the structure of a project in a more transparent manner</li>
</ul>

<h2>
<a id="dockerfile" class="anchor" href="#dockerfile" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Dockerfile</h2>

<ul>
<li>use <code>ENTRYPOINT</code> and <code>CMD</code> directives together to make container usage more convenient</li>
<li>combine consecutive <code>RUN</code> directives with <code>&amp;&amp;</code> to reduce the costs of a build and to avoid caching of instructions like <code>apt-get update</code>
</li>
<li>use <code>EXPOSE</code> to document all needed ports</li>
</ul>

<h1>
<a id="4-additional-material" class="anchor" href="#4-additional-material" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>4. Additional Material</h1>

<ul>
<li>
<a href="http://shop.oreilly.com/product/0636920035671.do">Mouat, A. (2015). <em>Using Docker: Developing and Deploying Software with Containers.</em> O'Reilly Media.</a> (<a href="https://www.dpunkt.de/buecher/12553/9783864903847-docker.html">German Edition: <em>Docker. Software entwickeln und deployen mit Containern.</em> dpunkt.verlag</a>)</li>
<li><a href="https://docs.docker.com/">Official Docker Documentation</a></li>
<li><a href="http://stackoverflow.com/documentation/docker/topics">StackOverflow Documentation</a></li>
</ul>

      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/JensPiegsa/docker-cheat-sheet">Docker Cheat Sheet</a> is maintained by <a href="https://github.com/JensPiegsa">JensPiegsa</a>.</span>

        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

    </section>

  
  </body>
</html>
